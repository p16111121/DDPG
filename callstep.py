import matlab.engine
import numpy as np

eng=matlab.engine.start_matlab()
init = [0.5 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0]
#init = [0.68724342	,0	,-0.016318482	,0	,-0.012160639	,0	,15.12535317	,0	,0.120144841	,0	,-0.086991665	,0]
#init = [0.678035764	,0	,0.000128504	,0	,0.000517704	,0	,11.70890025	,0	,0.011566594	,0	,0.0000879516213244234	,0]
StateVec=[]
PressureSensor=[]
StateVec.append(init)
stern=4
#stern_recode=[4,4,4,6,6,4,4,4,4,4,4,4,4,4,4,2,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0]
# C type
stern_recode=[15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.6872335889185,15.4150567193351,15.2910504542558,14.9300208005408,14.3773915209934,13.8318005095405,13.2349239331730,12.8680264766245,12.0250769298964,11.2510659414080,10.0588779351369,9.01499717966592,8.11028081689893,5,6.00751541064430,5.38561153908943,4.93179181236110,4.58646439990563,4.50514762006851,4.24701609036154,4.07692485841270,4.01364219926568,3.54332190545833,3.27283091005143,3.43518745244872,3.62791927614927,3.70706253791938,3.95421558053803,4.07474824187781,4.13320253856729,4.11551766380141,4.10380598690584,4.08712668614215,4.06646274360609,4.04928607705937,4.05120618781360,4.01729938825559,3.98232478900397,3.97669968242590,3.99596069810538,4.03165858760910,4.07330859339239,4.11044424496726,4.13509478095992,4.14356672809990,4.13655272221323,4.11819264661657,4.09460206883566,4.06101259850667,4.03768415178670,4.05941373449325,4.08455853354622,4.10697728632776,4.12197749243996,4.12683226209315,4.12148584323357,4.10852209532618,4.09207774312174,4.07657788205601,4.06568611129759,4.06158403434823,4.06450003419372,4.07279713005309,4.08374584175993,4.09438993473405,4.10222439036213,4.10564968468279,4.10427736731147,4.09897733553788,4.09150721333304,4.08395668118535,4.07820021339194,4.07547828550930,4.07614704129218,4.07965385695659,4.08480163280779,4.09013989866448,4.09434156350225,4.09649146233787,4.09626356191788,4.09396347885783,4.09038534443498,4.08655580168217,4.08345402039650,4.08177809942350,4.08180053501082,4.08333480515575,4.08583495605367,4.08857680591724,4.09085607026408,4.09215499220996,4.09224906482826,4.09123793095576,4.08948855853445,4.08751438026057,4.08583119120064,4.08483026394473,4.08469143608304,4.08536053454241,4.08658599491778,4.08800406191694,4.08924212614512,4.09001029895257,4.09016312528418,4.08972482303616,4.08886530248686,4.08784231369810,4.08692858933636,4.08634187100798,4.08619546111539,4.08648132786816,4.08708378791077,4.08781994281435,4.08849220221476,4.08893880214946,4.08907088946600,4.08888739987846,4.08846611625276,4.08793625451276,4.08744173349053,4.08710300488765,4.08698925362458,4.08710659151849,4.08740198867429,4.08778363773110,4.08814730586655,4.08840381580253,4.08849856275202,4.08842507637265,4.08821893218770,4.08794492474645,4.08767856816568,4.08748573835246,4.08740957157775,4.08745495012647,4.08759801064142,4.08779299953266,4.08798619081725,4.08812926693062,4.08818836499254,4.08815896646900,4.08805841498331,4.08791913183369,4.08777936384146,4.08767480323381,4.08763338849001,4.08765566619359,4.08772744034408,4.08782587568236,4.08792440865813,4.08799529654651,4.08801786500838,4.08799433075807,4.08794303071883,4.08787711294681,4.08781677275089,4.08778695539235,4.08779496883618,4.08782730934769,4.08786036514001,4.08787481691680,4.08786575695672,4.08783950993416,4.08780736756011]
for i in range(len(stern_recode)):
    print("i=",i)
    [newstate,pressure]=eng.step(matlab.double([init]),matlab.double([stern]),matlab.double([i]),nargout=2)
    #print(type(newstate))
    init=newstate
    
    newstate=np.array(newstate)
    #print(newstate,newstate.flatten()[10])
    StateVec.append(newstate.flatten().tolist())
    
    pressure=np.array(pressure)
    PressureSensor.append(pressure.flatten().tolist())
    
    stern=stern_recode[i]

import csv

with open("state_test.csv","w",newline="") as f:
    cw=csv.writer(f)
    cw.writerows(StateVec[j] for j in range(len(StateVec)))

with open("PressureSensor_test.csv","w",newline="") as f:
    cw=csv.writer(f)
    cw.writerows(PressureSensor[j] for j in range(len(PressureSensor)))
